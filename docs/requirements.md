# お問い合わせフォームシステム - 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名

Laravel Breeze × Next.js お問い合わせフォームシステム

### 1.2 目的

Web サイト訪問者からのお問い合わせを効率的に収集・管理し、管理者が適切に対応できるシステムを構築する。

### 1.3 想定ユーザー

-   **一般ユーザー**: Web サイト訪問者（お問い合わせ送信者）
-   **管理者**: 企業の担当者（お問い合わせ対応者）

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 お問い合わせフォーム機能（一般ユーザー向け）

**機能 ID**: F001  
**機能名**: お問い合わせフォーム送信

**詳細**:

-   ユーザーが Web フォームから以下の情報を入力・送信できる
    -   お名前（必須）
    -   メールアドレス（必須）
    -   件名（必須）
    -   メッセージ本文（必須）
-   入力値のバリデーション機能
-   送信完了時の確認メッセージ表示
-   送信エラー時のエラーメッセージ表示

**受入条件**:

-   全必須項目が入力されていない場合、送信不可
-   メールアドレス形式が正しくない場合、エラー表示
-   送信成功時、フォームがクリアされる
-   送信中は重複送信を防止する

---

#### 2.1.2 管理画面機能（管理者向け）

**機能 ID**: F002  
**機能名**: 管理者認証

**詳細**:

-   Laravel Breeze による認証機能
-   ログイン・ログアウト機能
-   認証されたユーザーのみ管理画面にアクセス可能

**受入条件**:

-   未認証ユーザーは管理画面にアクセス不可
-   セッション管理が適切に行われる

---

**機能 ID**: F003  
**機能名**: お問い合わせ一覧表示

**詳細**:

-   受信したお問い合わせを一覧表示
-   以下の 2 つのタブで分類表示
    -   未処理タブ：エクスポート前のデータ
    -   エクスポート済みタブ：エクスポート後のデータ
-   表示項目：ID、お名前、メールアドレス、件名、メッセージ（省略表示）、送信日時
-   ページネーション機能（20 件/ページ）
-   個別選択・全選択機能

**受入条件**:

-   データは送信日時の降順で表示
-   メッセージは長い場合省略表示
-   各タブの件数が表示される

---

**機能 ID**: F004  
**機能名**: CSV エクスポート機能

**詳細**:

-   未処理タブからデータを CSV ファイルとしてエクスポート
-   選択項目のみエクスポート、または全件エクスポートが可能
-   エクスポート実行後、対象データは「エクスポート済み」ステータスに変更
-   エクスポート後、自動的にエクスポート済みタブに移動
-   CSV ファイル名：`contact_forms_YYYY-MM-DD_HH-mm-ss.csv`

**受入条件**:

-   エクスポート対象は未処理データのみ
-   エクスポート後、該当データは未処理タブから消える
-   CSV には全項目（ID、名前、メール、件名、メッセージ、送信日時）が含まれる
-   文字化け対策が施されている

---

**機能 ID**: F005  
**機能名**: データ削除機能

**詳細**:

-   エクスポート済みタブからデータを削除可能
-   個別削除・一括削除機能
-   削除前の確認ダイアログ表示

**受入条件**:

-   エクスポート済みデータのみ削除可能
-   削除は物理削除（データベースから完全削除）
-   削除前に確認メッセージが表示される

### 2.2 非機能要件

#### 2.2.1 性能要件

-   お問い合わせフォーム送信：3 秒以内
-   管理画面一覧表示：5 秒以内
-   CSV エクスポート：10,000 件まで 30 秒以内
-   同時アクセス：100 ユーザーまで対応

#### 2.2.2 セキュリティ要件

-   管理画面は認証必須
-   CSRF 攻撃対策実装
-   SQL インジェクション対策実装
-   XSS 攻撃対策実装
-   レート制限実装（API: 60req/分、フォーム送信: 5 回/分）
-   HTTPS 通信必須

#### 2.2.3 可用性要件

-   システム稼働率：99.0%以上
-   定期メンテナンス時間を除く

#### 2.2.4 保守性要件

-   コードの可読性確保
-   適切なログ出力
-   エラーハンドリング実装
-   テスト可能な設計

## 3. 技術要件

### 3.1 開発技術

-   **フロントエンド**: Next.js (React)
-   **バックエンド**: Laravel (PHP)
-   **認証**: Laravel Breeze + Sanctum
-   **データベース**: MySQL / PostgreSQL
-   **スタイリング**: Tailwind CSS

### 3.2 デプロイ環境

-   **フロントエンド**: Vercel
-   **バックエンド**: Railway / DigitalOcean App Platform
-   **データベース**: 各プラットフォームのマネージド DB

### 3.3 外部連携

-   なし（将来的にメール通知機能を検討）

## 4. 制約事項

### 4.1 技術制約

-   Vercel の制限に準拠
-   サーバーレス環境での動作を前提
-   ファイルアップロード機能は含まない

### 4.2 運用制約

-   24 時間 365 日の監視体制は不要
-   バックアップは日次で十分
-   データ保持期間の制限なし（手動削除のみ）

### 4.3 予算制約

-   開発コストを最小限に抑制
-   運用コストは月額$50 以下を目標

## 5. 運用要件

### 5.1 バックアップ要件

-   データベースの日次バックアップ
-   バックアップデータの 30 日間保持

### 5.2 監視要件

-   アプリケーションエラーログの監視
-   データベース接続エラーの監視
-   レスポンス時間の監視

### 5.3 メンテナンス要件

-   月次でのセキュリティアップデート適用
-   四半期ごとの性能レビュー

## 6. スケジュール

### 6.1 開発フェーズ

-   **設計フェーズ**: 3 日
-   **開発フェーズ**: 10 日
    -   バックエンド API 開発: 5 日
    -   フロントエンド開発: 4 日
    -   統合テスト: 1 日
-   **テストフェーズ**: 3 日
-   **デプロイフェーズ**: 2 日

### 6.2 総開発期間

約 18 日間（約 3.5 週間）

## 7. リスクと対策

### 7.1 技術リスク

**リスク**: Vercel での Laravel デプロイの困難性  
**対策**: 代替ホスティングサービス（Railway、DigitalOcean）の検討・準備

**リスク**: CORS 設定の複雑性  
**対策**: 開発初期段階での CORS 設定テスト実施

### 7.2 運用リスク

**リスク**: スパム送信の増加  
**対策**: レート制限と CAPTCHA 導入の検討

**リスク**: データ量増加によるパフォーマンス劣化  
**対策**: インデックス最適化とアーカイブ機能の実装

## 8. 成功基準

### 8.1 機能面

-   お問い合わせフォームが正常に動作する
-   管理画面で全機能が期待通り動作する
-   CSV エクスポート・削除機能が正常に動作する

### 8.2 性能面

-   性能要件を満たす
-   エラー率 1%以下

### 8.3 運用面

-   デプロイが成功し、本番環境で安定動作する
-   基本的な運用手順書が整備される

## 9. 将来拡張予定

### 9.1 短期（3 ヶ月以内）

-   メール自動返信機能
-   管理者への新着お問い合わせ通知機能

### 9.2 中期（6 ヶ月以内）

-   お問い合わせカテゴリ分類機能
-   対応状況管理機能
-   ダッシュボード機能

### 9.3 長期（1 年以内）

-   ファイルアップロード機能
-   お問い合わせ履歴検索機能
-   レポート機能

---

**文書作成日**: 2025 年 7 月 27 日  
**文書バージョン**: 1.0  
**作成者**: システム開発担当者  
**承認者**: プロジェクトマネージャー
